#!/bin/bash

# 主部署入口脚本
# 提供统一的部署命令入口

set -e

# 脚本目录
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# 颜色定义
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# 显示横幅
show_banner() {
    echo -e "${BLUE}"
    echo "╔══════════════════════════════════════════════════════════════╗"
    echo "║                Online Clipboard Deployment                  ║"
    echo "║                    Choose Your Method                        ║"
    echo "╚══════════════════════════════════════════════════════════════╝"
    echo -e "${NC}"
}

# 显示选项
show_options() {
    echo "Available deployment methods:"
    echo ""
    echo -e "${GREEN}1. Quick Deploy${NC} - Fast and simple (recommended for development)"
    echo "   ./deploy quick [command]"
    echo ""
    echo -e "${GREEN}2. Full Deploy${NC} - Complete with health checks and backup (recommended for production)"
    echo "   ./deploy full [command]"
    echo ""
    echo -e "${GREEN}3. Legacy Deploy${NC} - Original deployment scripts"
    echo "   ./deploy legacy"
    echo ""
    echo -e "${YELLOW}Quick commands:${NC}"
    echo "   ./deploy                    # Interactive mode"
    echo "   ./deploy quick              # Quick deployment"
    echo "   ./deploy full               # Full deployment"
    echo "   ./deploy quick logs         # Quick logs"
    echo "   ./deploy full status        # Full status"
    echo ""
}

# 交互式选择
interactive_mode() {
    show_banner
    show_options
    
    echo "Select deployment method:"
    echo "1) Quick Deploy"
    echo "2) Full Deploy"
    echo "3) Legacy Deploy"
    echo "4) Show help"
    echo ""
    read -p "Enter your choice (1-4): " choice
    
    case $choice in
        1)
            echo -e "${GREEN}Starting Quick Deploy...${NC}"
            exec "$SCRIPT_DIR/quick-deploy.sh" "${@:2}"
            ;;
        2)
            echo -e "${GREEN}Starting Full Deploy...${NC}"
            exec "$SCRIPT_DIR/deploy-unified.sh" "${@:2}"
            ;;
        3)
            echo -e "${GREEN}Starting Legacy Deploy...${NC}"
            exec "$SCRIPT_DIR/deploy.sh" "${@:2}"
            ;;
        4)
            show_options
            ;;
        *)
            echo "Invalid choice. Please select 1-4."
            exit 1
            ;;
    esac
}

# 主逻辑
main() {
    local method=${1:-interactive}
    
    case "$method" in
        "quick"|"q")
            exec "$SCRIPT_DIR/quick-deploy.sh" "${@:2}"
            ;;
        "full"|"f"|"unified"|"u")
            exec "$SCRIPT_DIR/deploy-unified.sh" "${@:2}"
            ;;
        "legacy"|"l"|"original"|"o")
            exec "$SCRIPT_DIR/deploy.sh" "${@:2}"
            ;;
        "help"|"--help"|"-h")
            show_options
            ;;
        "interactive"|"i"|"")
            interactive_mode "$@"
            ;;
        *)
            echo "Unknown method: $method"
            echo ""
            show_options
            exit 1
            ;;
    esac
}

# 运行主函数
main "$@"